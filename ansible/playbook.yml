---
# Nexus Homelab Ansible Playbook
# Usage: ansible-playbook playbook.yml --extra-vars "services=plex,jellyfin"

- name: Deploy Nexus Homelab
  hosts: localhost
  connection: local
  become: yes
  vars_files:
    - vars/vault.yml

  pre_tasks:
    - name: Display deployment information
      ansible.builtin.debug:
        msg:
          - "Services to deploy: {{ services | default('all') }}"
          - "Domain: {{ domain | default('not set') }}"
          - "Nexus Root: {{ nexus_root_directory | default(ansible_env.HOME + '/dev/focus') }}"

  roles:
    - role: docker
      tags: ['docker', 'setup']

    - role: nexus
      tags: ['nexus', 'deploy']
      vars:
        nexus_services: "{{ services | default('all') }}"

    - role: monitoring
      tags: ['monitoring']
      when: enable_monitoring | default(false)

    - role: alerting
      tags: ['alerting']
      when: enable_alerting | default(false)
