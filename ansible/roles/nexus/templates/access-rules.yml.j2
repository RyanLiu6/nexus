# Tailscale Access Rules
#
# This file defines:
# 1. Group memberships (must match Tailscale ACL policy)
# 2. Per-service access rules
#
# Used by the tailscale-access ForwardAuth middleware.
#
# GENERATED BY ANSIBLE - DO NOT EDIT MANUALLY

# =============================================================================
# GROUP MEMBERSHIPS
# =============================================================================
# These must match the groups in acl-policy.jsonc
# The middleware uses these to determine a user's groups from their email
groups:
{% for group, emails in tailscale_users.items() %}
  {{ group }}:
{% for email in emails %}
    - {{ email }}
{% endfor %}
{% endfor %}

# =============================================================================
# DEFAULT BEHAVIOR
# =============================================================================
# What to do when a service is not listed below
# Options: allow, deny
default: deny

# =============================================================================
# SERVICE ACCESS RULES
# =============================================================================
# Format: service_name → list of groups that can access
#
# The service name is extracted from the Host header:
#   grafana.example.com → grafana
#   hub.example.com → hub
services:
  # ---------------------------------------------------------------------------
  # Admin-only services (infrastructure, monitoring)
  # ---------------------------------------------------------------------------
  traefik:
    groups: [admins]
    description: "Reverse proxy dashboard"

  grafana:
    groups: [admins]
    description: "Metrics visualization"

  prometheus:
    groups: [admins]
    description: "Metrics collection"

  node-exporter:
    groups: [admins]
    description: "Node metrics"

  alertmanager:
    groups: [admins]
    description: "Alert management"

  transmission:
    groups: [admins]
    description: "Torrent client"

  jellyfin:
    groups: [admins]
    description: "Media server"

  plex:
    groups: [admins]
    description: "Media streaming"

  nextcloud:
    groups: [admins]
    description: "File storage"

  # ---------------------------------------------------------------------------
  # Finance services
  # ---------------------------------------------------------------------------
  sure:
    groups: [admins, finance]
    description: "Personal finance"

  # ---------------------------------------------------------------------------
  # Shared services (all groups)
  # ---------------------------------------------------------------------------
  foundryvtt:
    groups: [admins, members, finance]
    description: "Virtual tabletop"

  foundry:
    groups: [admins, members, finance]
    description: "Virtual tabletop (alias)"

  homepage:
    groups: [admins, members, finance]
    description: "Dashboard"

  hub:
    groups: [admins, members, finance]
    description: "Dashboard (alias)"
